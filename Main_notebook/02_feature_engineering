# ğŸ“Œ 02_feature_engineering.ipynb
# Objetivo: Extraer y seleccionar caracterÃ­sticas relevantes de las seÃ±ales ECG

import pandas as pd
import numpy as np
import scipy.signal as sc
import matplotlib.pyplot as plt

# ğŸ“‚ Cargar datos preprocesados
processed_path = "/content/drive/My Drive/PSF/training_v2_clean.csv"
df = pd.read_csv(processed_path)
print("âœ… Datos cargados correctamente para ingenierÃ­a de caracterÃ­sticas.")

# ğŸ”¹ Definir funciones para extracciÃ³n de caracterÃ­sticas
def compute_mean(signal):
    return np.mean(signal)

def compute_std(signal):
    return np.std(signal)

def compute_median(signal):
    return np.median(signal)

def compute_max(signal):
    return np.max(signal)

def compute_min(signal):
    return np.min(signal)

def compute_bandpower(signal, fs=300):
    f, Pxx = sc.welch(signal, fs=fs)
    return np.sum(Pxx)

# ğŸ” Aplicar funciones de caracterÃ­sticas sobre las seÃ±ales ECG
feature_df = pd.DataFrame()
feature_df['mean'] = df.iloc[:, 1:].apply(compute_mean, axis=1)
feature_df['std'] = df.iloc[:, 1:].apply(compute_std, axis=1)
feature_df['median'] = df.iloc[:, 1:].apply(compute_median, axis=1)
feature_df['max'] = df.iloc[:, 1:].apply(compute_max, axis=1)
feature_df['min'] = df.iloc[:, 1:].apply(compute_min, axis=1)
feature_df['bandpower'] = df.iloc[:, 1:].apply(compute_bandpower, axis=1)

# ğŸ“Š Visualizar primeras filas del nuevo dataset con caracterÃ­sticas
display(feature_df.head())

# ğŸš€ Guardar caracterÃ­sticas extraÃ­das
features_path = "/content/drive/My Drive/PSF/training_features.csv"
feature_df.to_csv(features_path, index=False)
print(f"âœ… CaracterÃ­sticas extraÃ­das y guardadas en {features_path}")
